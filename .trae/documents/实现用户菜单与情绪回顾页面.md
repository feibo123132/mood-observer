非常专业的架构要求！将数据处理逻辑与 UI 渲染分离是 React 开发的最佳实践，能显著提升代码的可维护性和复用性。

我将严格按照您的要求执行：

## 1. 逻辑解耦 (Custom Hook)
*   **创建**: `src/hooks/useMoodStats.ts`
*   **功能**:
    *   从 `useMoodStore` 获取原始 `records`。
    *   `moodDistribution`: 根据 11 个情绪档次（使用 `getMoodState` 判断）聚合统计数量。
    *   `weeklyRecords`: 筛选最近 7 天数据，并接受 `sortBy` 参数 ('time' | 'score_desc' | 'score_asc') 进行排序处理。

## 2. 稳定的 UI 组件 (UserMenu)
*   **创建**: `src/components/UserMenu.tsx`
*   **实现**:
    *   使用一个全屏透明遮罩 (`fixed inset-0`) 来处理“点击外部关闭”。
    *   菜单面板绝对定位在右上角，增加阴影和圆角，确保在移动端触摸区域友好。
    *   包含选项：`日历视图`、`情绪回顾`、`退出登录`。

## 3. 情绪回顾页面 (ReviewPage)
*   **创建**: `src/pages/ReviewPage.tsx`
*   **实现**:
    *   引入 `useMoodStats` Hook。
    *   **Tab 1: 总回顾** - 展示 11 个情绪胶囊/卡片，显示次数分布。
    *   **Tab 2: 周回顾** - 顶部提供排序切换（默认按时间，点击切换为按分数高->低）。
    *   复用 `CalendarPage` 中的记录列表样式来展示详细数据。

## 4. 路由与入口整合
*   修改 `App.tsx` 注册 `/review` 路由。
*   修改 `HomePage.tsx` 引入 `UserMenu` 组件。

我将从最核心的 Hook 开始编写。